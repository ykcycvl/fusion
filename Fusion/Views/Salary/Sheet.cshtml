@model Fusion.Models.SalaryModels.Organization

@{
    ViewBag.Title = "Ведомость " + Model.FullName;
    Layout = "~/Views/Shared/_LayoutWide.cshtml";
}
<style>
    table thead,
    table tbody {
        overflow: auto;
    }

    table tbody {
        overflow: auto;
        display: block;
        height: 500px;
    }

    thead {
        display: block;
    }

    tbody tr td {
        white-space: nowrap;
    }

    input {
        width: 98%;
        padding: 0px;
        margin: 0px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
    }
    .day {
        width: 36px;
    }
    .accr {
        width: 185px;
    }
    .subdivision {
        font-weight: bold;
        text-align: center;
    }
</style>

<h2>@ViewBag.Error</h2>

@using (Html.BeginForm("Sheet", "Salary", FormMethod.Post))
{
    @Html.TextBoxFor(m => m.Period)
    @Html.HiddenFor(m => m.FullName)

    <table class="table-bordered table-condensed table-responsive table-striped" id="selector">
        <thead>
            <tr>
                <th rowspan="2" width="491px" style="text-align: center;">@ViewBag.Title</th>
                @for (int t = 1; t <= DateTime.DaysInMonth(Model.Period.Year, Model.Period.Month); t++)
                {
                    if (System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek) == "Сб" || System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek) == "Вс")
                    {
                        <th style="color: #e00" class="day">
                            @t
                        </th>
                    }
                    else
                    {
                        <th class="day">
                            @t
                        </th>
                    }
                }
                @for (int t = 0; t < Model.Accruals.Count; t++)
                {
                    <th rowspan="2" class="accr">
                        @Html.HiddenFor(m => m.Accruals[t].Code)
                        @Html.HiddenFor(m => m.Accruals[t].Name)
                        @Html.HiddenFor(m => m.Accruals[t].Sum)
                        @Model.Accruals[t].Name
                    </th>
                }
                @for (int t = 0; t < Model.Detentions.Count; t++)
{
    <th rowspan="2" class="accr">
        @Html.HiddenFor(m => m.Detentions[t].Code)
        @Html.HiddenFor(m => m.Detentions[t].Name)
        @Html.HiddenFor(m => m.Detentions[t].Sum)
        @Model.Detentions[t].Name
    </th>
}
            </tr>
            <tr>
                @for (int t = 1; t <= DateTime.DaysInMonth(Model.Period.Year, Model.Period.Month); t++)
{
    if (System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek) == "Сб" || System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek) == "Вс")
    {
        <th style="color: #e00" class="day">
            @System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek)
        </th>
    }
    else
    {
        <th class="day">
            @System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetAbbreviatedDayName(new DateTime(Model.Period.Year, Model.Period.Month, t).DayOfWeek)
        </th>
    }
}
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Subdivisions.Count; i++)
            {
                int colspan = 2 + DateTime.DaysInMonth(Model.Period.Year, Model.Period.Month) + Model.Detentions.Count +Model.Accruals.Count -2;
                <tr>
                    <td class="subdivision">
                        @Html.HiddenFor(m => m.Subdivisions[i].Code)
                        @Html.HiddenFor(m => m.Subdivisions[i].FullName)
                        @Model.Subdivisions[i].FullName
                    </td>
                    <td></td>

                </tr>
                for (int j = 0; j < Model.Subdivisions[i].Employees.Count; j++)
                {
                    <tr>
                        <td>
                            @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Code)
                            @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].FullName)
                            @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Position)
                            @Model.Subdivisions[i].Employees[j].Position
                        </td>
                        <td>
                            @Model.Subdivisions[i].Employees[j].FullName
                        </td>
                        @for (int t = 1; t <= Model.Subdivisions[i].Employees[j].TimeSheet.Count; t++)
                        {
                            <td>
                                @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].TimeSheet[t - 1].Day)
                                @Html.TextBoxFor(m => m.Subdivisions[i].Employees[j].TimeSheet[t - 1].Hours, new { @style = "width: 25px; border: none; background: #f8f8f8;" })
                            </td>
                        }
                        @for (int k = 0; k < Model.Subdivisions[i].Employees[j].Accruals.Count; k++)
                        {
                            <td>
                                @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Accruals[k].Code)
                                @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Accruals[k].Name)
                                @Html.TextBoxFor(m => m.Subdivisions[i].Employees[j].Accruals[k].Sum, new { @style = "width: 173px; border: none; background: #f8f8f8;" })
                            </td>
                        }
                        @for (int k = 0; k < Model.Subdivisions[i].Employees[j].Detentions.Count; k++)
                        {
                            <td>
                                @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Detentions[k].Code)
                                @Html.HiddenFor(m => m.Subdivisions[i].Employees[j].Detentions[k].Name)
                                @Html.TextBoxFor(m => m.Subdivisions[i].Employees[j].Detentions[k].Sum, new { @style = "width: 173px; border: none; background: #f8f8f8;" })
                            </td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>

    <input type="submit" value="Сохранить" />
}
